{"version":3,"file":"js/989.ae722569.js","mappings":"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","sources":["webpack://node-demo/./src/components/swapAlert.vue","webpack://node-demo/./src/components/swapAlert.vue?6f3c","webpack://node-demo/./src/views/Exchange/index.vue","webpack://node-demo/./src/views/Exchange/index.vue?853a"],"sourcesContent":["<script setup>\nimport { ref, reactive, toRefs } from 'vue';\nimport popupTitle from '@/components/popupTitle.vue';\nimport { commonStore } from '@/store/common';\nimport useClipboard from 'vue-clipboard3';\nimport loadingIcon from './loadingIcon.vue';\n\nconst props = defineProps({\n  finish: Boolean,\n  success: Boolean,\n  hash: String,\n  type: String,\n  text: String,\n  title: String,\n  btn: String,\n  empowerText: String,\n  empower: Boolean,\n  check: Boolean,\n});\n\nconst { hash } = toRefs(props);\nconst emit = defineEmits(['closeFn', 'empowerFn', 'submit']);\nconst common_store = commonStore();\nconst { toClipboard } = useClipboard();\n</script>\n<template>\n  <div class=\"bind allFlex column\">\n    <span\n      class=\"success-btn Wcolor font-Two\"\n      :class=\"[success ? 'btnBg' : 'redBg']\"\n      v-show=\"finish\"\n      >{{ success ? $t('success') : $t('fail') }}</span\n    >\n    <loading-icon class=\"loading\" v-show=\"!finish && check\"></loading-icon>\n    <p class=\"popup-title Wcolor font-Eight font500 center\">\n      {{ $t(title) }}\n    </p>\n    <div class=\"bind_ipt center Wcolor\" v-if=\"!finish\">\n      <slot></slot>\n    </div>\n\n    <div\n      class=\"bind_ipt bgPadding center\"\n      :class=\"[success ? 'mainColor font-Ty' : 'redColor hashFont font-Four']\"\n      v-if=\"finish\"\n    >\n      {{ success ? $t(text) : hash }}\n    </div>\n    <div class=\"bgPadding\">\n      <n-button\n        type=\"tertiary\"\n        v-if=\"!empower\"\n        :disabled=\"check\"\n        class=\"font-Three btn\"\n        block\n        @click=\"$emit('empowerFn')\"\n        >{{ $t(empowerText) }}</n-button\n      >\n      <n-button\n        class=\"btn font-Three\"\n        type=\"primary\"\n        :disabled=\"!empower || check\"\n        @click=\"$emit('submit')\"\n        v-show=\"!finish\"\n        block\n        >{{ $t(btn) }}</n-button\n      >\n      <n-button\n        class=\"btn font-Three\"\n        :type=\"success ? 'primary' : 'error'\"\n        v-show=\"finish\"\n        block\n        @click=\"$emit('closeFn')\"\n        >{{ $t('SwapAlert.close') }}</n-button\n      >\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.popup-title {\n  position: relative;\n  height: 50px;\n  line-height: 50px;\n}\n.bind {\n  width: 378px;\n  height: 250px;\n  background: url('../assets/commonImg/alert-bg1.png') no-repeat;\n  background-size: 100% 100%;\n  position: relative;\n  padding: 4px 10px 30px 10px;\n  &_ipt {\n    text-overflow: ellipsis;\n    word-break: break-all;\n    padding: 15px;\n    line-height: 30px;\n    max-height: 120px;\n    overflow-y: scroll;\n  }\n}\n.loading {\n  position: absolute;\n  top: 15px;\n  right: 15px;\n}\n.success-btn {\n  padding: 2px 6px;\n  border-radius: 4px;\n  transform: scale(0.8);\n  position: absolute;\n  top: 15px;\n  right: 10px;\n}\n.btn {\n  text-align: center;\n  margin-top: 10px;\n}\n</style>\n","import script from \"./swapAlert.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./swapAlert.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./swapAlert.vue?vue&type=style&index=0&id=65675c50&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/zhuweiyun/Desktop/zwy/vue3-pc-天空之城/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-65675c50\"]])\n\nexport default __exports__","<script setup>\nimport { ref, reactive, onBeforeMount, watch, watchEffect } from 'vue';\n// import coinIpt from './components/coinIpt.vue';\nimport { swapStore } from '@/store/swap';\nimport { commonStore } from '@/store/common';\nimport swapAlert from '@/components/swapAlert.vue';\nimport { useI18n } from 'vue-i18n';\nimport { NModal, NPopover } from 'naive-ui';\nimport { balanceUtil, numberUtils, mathFloor } from '@/utils';\nimport { MaxUint256 } from '@ethersproject/constants';\nconst icon1 = require('@assets/exchangeImg/icon1.png');\nconst icon2 = require('@assets/exchangeImg/icon2.png');\nconst swap_store = swapStore();\nconst common_store = commonStore();\nconst { t } = useI18n();\nconst data = reactive({\n  tokenBal: '',\n  usdtBal: '',\n  usdt: '',\n  token: '',\n  check: false,\n  usdtFocus: false,\n  tokenFocus: false,\n  alertShow: false,\n  finish: false,\n  success: false,\n  hash: '',\n  hashType: 2,\n  showPopover: false,\n  empower: false,\n  checkShow: false,\n  empowerText: 'EmpowerAlert.btn4',\n});\n\nconst getUsdtBal = async () => {\n  const res = await swap_store.usdtMethods\n    .balanceOf(common_store.address)\n    .call();\n  data.usdtBal = balanceUtil(res + '');\n  console.log(res);\n  console.log(data);\n};\nconst getTokenBal = async () => {\n  const res = await swap_store.tokenMethods\n    .balanceOf(common_store.address)\n    .call();\n  data.tokenBal = balanceUtil(res + '');\n};\nonBeforeMount(async () => {\n  common_store.initMarketWeb3();\n  // if (!swap_store.tokenEmpower) {\n  await swap_store.getTokenMethods();\n  // }\n  // if (!swap_store.usdtEmpower) {\n  await swap_store.getUsdtMethods();\n  // }\n});\nwatchEffect(() => {\n  if (common_store.address && swap_store.usdtEmpower) {\n    getUsdtBal();\n    getTokenBal();\n  }\n});\nwatch(\n  () => data.usdt,\n  (val) => {\n    if (!data.tokenFocus) {\n      if (!data.check) {\n        data.token = val >= 0.001 ? mathFloor(val, 3) : '0';\n      } else {\n        data.token = val ? mathFloor(val / 0.95, 3) : '';\n      }\n    }\n  }\n);\nwatch(\n  () => data.token,\n  (val) => {\n    if (!data.usdtFocus) {\n      if (!data.check) {\n        data.usdt = val >= 0.001 ? mathFloor(val, 3) : '0';\n      } else {\n        data.usdt = val ? mathFloor(val * 0.95, 3) : '';\n      }\n    }\n  }\n);\nwatch(\n  () => data.check,\n  (val) => {\n    data.value = '';\n    data.usdt = '';\n    data.token = '';\n    data.usdtFocus = false;\n    data.tokenFocus = false;\n  }\n);\nconst toSwap = async () => {\n  const value = data.check ? data.token : data.usdt;\n  if (!value) {\n    window.$message.warning(t('Swap.number'));\n    return;\n  }\n  if (data.check && +data.tokenBal < +value) {\n    window.$message.warning(t('skytBal'));\n    return;\n  }\n  if (!data.check && +data.usdtBal < +value) {\n    window.$message.warning(t('usdtBal'));\n    return;\n  }\n\n  if (data.check) {\n    data.empower = swap_store.marketEmpower;\n    data.empowerText = 'EmpowerAlert.btn4';\n  } else {\n    data.empower = swap_store.usetMarketEmpower;\n    data.empowerText = 'EmpowerAlert.btn3';\n  }\n\n  data.hashType = !data.check ? 2 : 3;\n  data.alertShow = true;\n  data.finish = false;\n  data.success = false;\n};\nconst submit = async () => {\n  if (data.checkShow) {\n    return;\n  }\n  data.checkShow = true;\n  const value = data.check ? data.token : data.usdt;\n  const index = data.check ? 1 : 0;\n  try {\n    const res = await common_store.marketMethods\n      .swapCoin(index, numberUtils(value, 18))\n      .send({ from: common_store.address });\n    data.token = '';\n    data.usdt = '';\n    data.finish = true;\n    data.success = true;\n    data.hash = res.transactionHash;\n    common_store.addHash(data.hash, data.hashType);\n    data.checkShow = false;\n    getUsdtBal();\n    getTokenBal();\n  } catch (error) {\n    data.finish = true;\n    data.checkShow = false;\n    data.success = false;\n    data.hash = error.message;\n  }\n};\nconst empowerFn = async () => {\n  if (data.checkShow) {\n    return;\n  }\n  data.checkShow = true;\n  data.empowerText = 'EmpowerAlert.btn1';\n  //授权Token\n  if (data.check) {\n    try {\n      const res = await swap_store.tokenMethods\n        .approve(swap_store.marketSpender, MaxUint256)\n        .send({ from: common_store.address });\n      swap_store.setMarketEmpower();\n      data.checkShow = false;\n      data.empower = swap_store.marketEmpower;\n      data.empowerText = 'EmpowerAlert.btn4';\n    } catch (error) {\n      data.checkShow = false;\n      window.$message.error(error);\n    }\n  } else {\n    //授权USDT\n    try {\n      const res = await swap_store.usdtMethods\n        .approve(swap_store.marketSpender, MaxUint256)\n        .send({ from: common_store.address });\n      swap_store.setUsdtEmpower();\n      data.checkShow = false;\n      data.empower = swap_store.usdtMarketEmpower;\n      data.empowerText = 'EmpowerAlert.btn3';\n    } catch (error) {\n      data.checkShow = false;\n      window.$message.error(error);\n    }\n  }\n};\n</script>\n<template>\n  <div class=\"cen swap flex_center itCenter\">\n    <div class=\"exchange-main titleBg\">\n      <div class=\"main\" :class=\"[data.check ? 'end' : 'start']\">\n        <ul class=\"coin-ipt allFlex column\">\n          <li class=\"flex_between\">\n            <input\n              type=\"number\"\n              class=\"Wcolor font-Tt Bold\"\n              v-model=\"data.usdt\"\n              placeholder=\"0.0\"\n              @focus=\"data.usdtFocus = true\"\n              @blur=\"data.usdtFocus = false\"\n            />\n            <div class=\"flex_start coin-bg\">\n              <div class=\"icon\">\n                <n-popover trigger=\"hover\">\n                  <p class=\"font-Two Wcolor\">BNB Smart Chain(BEP20)</p>\n                  <template #trigger>\n                    <img\n                      src=\"@assets/exchangeImg/icon1.png\"\n                      alt=\"\"\n                      class=\"icon hand\"\n                    />\n                  </template>\n                </n-popover>\n              </div>\n\n              <span class=\"Wcolor marginTen font-Two\">USDT</span>\n            </div>\n          </li>\n          <li>\n            <span class=\"priceColor font-Two\"\n              >{{ $t('balance') }}：{{ Number(data.usdtBal) }}</span\n            >\n          </li>\n        </ul>\n        <div class=\"exchange-main_icon flex_end padding\">\n          <img\n            src=\"@assets/exchangeImg/exchange_icon.png\"\n            alt=\"\"\n            class=\"exchange_icon hand\"\n            @click=\"data.check = !data.check\"\n          />\n        </div>\n        <ul class=\"coin-ipt allFlex column\">\n          <li class=\"flex_between\">\n            <input\n              type=\"number\"\n              class=\"Wcolor font-Tt Bold\"\n              @focus=\"data.tokenFocus = true\"\n              @blur=\"data.tokenFocus = false\"\n              v-model=\"data.token\"\n              placeholder=\"0.0\"\n            />\n            <div class=\"flex_start coin-bg\">\n              <img src=\"@assets/exchangeImg/icon2.png\" alt=\"\" class=\"icon\" />\n              <span class=\"Wcolor marginTen font-Two\">SkyT</span>\n            </div>\n          </li>\n          <li class=\"\">\n            <span class=\"priceColor font-Two\"\n              >{{ $t('balance') }}：{{ Number(data.tokenBal) }}</span\n            >\n          </li>\n        </ul>\n      </div>\n\n      <div class=\"btn\">\n        <n-button\n          type=\"default\"\n          block\n          @click=\"empowerFn\"\n          size=\"large\"\n          class=\"font-Five Bold\"\n          :disabled=\"data.checkShow\"\n          v-if=\"\n            data.check\n              ? !swap_store.marketEmpower\n              : !swap_store.usetMarketEmpower\n          \"\n          >{{\n            data.checkShow\n              ? $t('EmpowerAlert.btn1')\n              : data.check\n              ? $t('EmpowerAlert.btn4')\n              : $t('EmpowerAlert.btn3')\n          }}</n-button\n        >\n        <n-button\n          type=\"primary\"\n          block\n          @click=\"toSwap\"\n          size=\"large\"\n          class=\"font-Five Bold\"\n          >{{ $t('Swap.btn') }}</n-button\n        >\n      </div>\n    </div>\n    <n-modal v-model:show=\"data.alertShow\">\n      <swap-alert\n        :finish=\"data.finish\"\n        :success=\"data.success\"\n        :hash=\"data.hash\"\n        title=\"SwapAlert.title1\"\n        text=\"SwapAlert.success1\"\n        btn=\"Swap.btn\"\n        @closeFn=\"data.alertShow = false\"\n        type=\"swap\"\n        :empower=\"data.empower\"\n        :empowerText=\"data.empowerText\"\n        @empowerFn=\"empowerFn\"\n        :check=\"data.checkShow\"\n        @submit=\"submit\"\n      >\n        <p class=\"font-Four\">\n          {{\n            data.hashType == 2\n              ? $t('Swap.type1', { token: data.token, usdt: data.usdt })\n              : $t('Swap.type2', { token: data.token, usdt: data.usdt })\n          }}\n        </p>\n      </swap-alert>\n    </n-modal>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.swap {\n  padding: 25px 0;\n  min-height: calc(100vh - 160px);\n}\n.exchange-main {\n  width: 450px;\n  margin: 0 auto;\n  padding: 30px 25px;\n  min-height: 350px;\n  border-radius: 20px;\n  &_icon {\n    margin: -10px 0;\n    position: relative;\n    z-index: 99;\n    img {\n      width: 40px;\n    }\n  }\n}\n.exchange_icon {\n  width: 38px;\n  height: 38px;\n}\n.btn {\n  margin-top: 35px;\n  .n-button {\n    margin-top: 20px;\n  }\n}\n.main {\n  display: flex;\n  justify-content: space-between;\n}\n.end {\n  flex-direction: column-reverse;\n}\n.start {\n  flex-direction: column;\n}\n.icon {\n  width: 25px;\n  height: 25px;\n}\n.coin-ipt {\n  background: #35404d;\n  border-radius: 15px;\n  padding: 15px;\n  height: 100px;\n  position: relative;\n  li:first-child {\n    height: 50px;\n  }\n  .coin-bg {\n    width: 88px;\n    height: 32px;\n    background: #4b566c;\n    border-radius: 16px;\n    padding-left: 2px;\n    position: relative;\n  }\n  input {\n    width: calc(100% - 90px);\n  }\n}\n.question_icon {\n  width: 18px;\n}\n.question {\n  // position: absolute;\n  // top: -14px;\n  // left: 20px;\n  &-p {\n    padding: 4px 10px;\n    background: #415367;\n  }\n}\n</style>\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=185190cf&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/zhuweiyun/Desktop/zwy/vue3-pc-天空之城/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-185190cf\"]])\n\nexport default __exports__"],"names":["hash","toRefs","props","toClipboard","commonStore","useClipboard","__exports__","require","swap_store","swapStore","common_store","t","useI18n","data","reactive","tokenBal","usdtBal","usdt","token","check","usdtFocus","tokenFocus","alertShow","finish","success","hashType","showPopover","empower","checkShow","empowerText","getUsdtBal","async","res","usdtMethods","balanceOf","address","call","balanceUtil","console","log","getTokenBal","tokenMethods","onBeforeMount","initMarketWeb3","getTokenMethods","getUsdtMethods","watchEffect","usdtEmpower","watch","val","mathFloor","value","toSwap","window","$message","warning","marketEmpower","usetMarketEmpower","submit","index","marketMethods","swapCoin","numberUtils","send","from","transactionHash","addHash","error","message","empowerFn","approve","marketSpender","MaxUint256","setMarketEmpower","setUsdtEmpower","usdtMarketEmpower"],"sourceRoot":""}